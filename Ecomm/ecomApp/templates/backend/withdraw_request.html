{% include 'backend/influencer_header.html' %}
{% include 'backend/influencer_sidebar.html' %}
{% load static %}
<br><br>

{% if messages %}
<div class="container mt-3" style="text-align:center;background-color:red;">
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}

<br>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h2 class="text-center mb-4">Withdraw Request</h2>

      <form method="POST" onsubmit="return combineBankDetails()">
        {% csrf_token %}

        <div class="mb-3">
          <label for="amount" class="form-label">Amount (â‚¹)</label>
          <input type="number" min="1" name="amount" id="amount" class="form-control" required>
        </div>

        <!-- Payment Method -->
        <div class="mb-3">
          <label class="form-label">Payment Method</label><br>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="payment_method" id="method_bank" value="bank" checked onchange="togglePaymentFields()">
            <label class="form-check-label" for="method_bank">Bank Transfer</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="payment_method" id="method_upi" value="upi" onchange="togglePaymentFields()">
            <label class="form-check-label" for="method_upi">UPI</label>
          </div>
        </div>

        <!-- UPI Field -->
        <div class="mb-3 d-none" id="upi_field">
          <label for="upi_id" class="form-label">UPI ID</label>
          <input type="text" id="upi_id" class="form-control">
        </div>

        <!-- Bank Details Fields -->
        <div id="bank_fields">
          <div class="mb-3">
            <label for="account_number" class="form-label">Bank Account Number</label>
            <input type="text" id="account_number" class="form-control">
          </div>

          <div class="mb-3">
            <label for="ifsc" class="form-label">IFSC Code</label>
            <input type="text" id="ifsc" class="form-control">
          </div>

          <div class="mb-3">
            <label for="bank_name" class="form-label">Bank Name</label>
            <input type="text" id="bank_name" class="form-control">
          </div>

          <div class="mb-3">
            <label for="branch_name" class="form-label">Branch Name</label>
            <input type="text" id="branch_name" class="form-control">
          </div>
        </div>

        <!-- Hidden field to submit final combined bank/upi details -->
        <input type="hidden" name="bank_address" id="bank_address" required>

        <button type="submit" class="btn btn-primary w-100">Submit Withdraw Request</button>
      </form>
    </div>
  </div>
</div>
<br><br><br><br><br><br><br>
<!-- Loader Overlay -->
<div id="loader-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.8); z-index:9999; text-align:center;">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Submitting your request...</p>
  </div>
</div>

<script>
  function togglePaymentFields() {
    const isUPI = document.getElementById('method_upi').checked;
    document.getElementById('upi_field').classList.toggle('d-none', !isUPI);
    document.getElementById('bank_fields').classList.toggle('d-none', isUPI);
  }

  function combineBankDetails() {
    const isUPI = document.getElementById('method_upi').checked;
    const bankAddressField = document.getElementById('bank_address');

    if (isUPI) {
      const upi = document.getElementById('upi_id').value.trim();
      if (!upi) {
        alert("Please enter your UPI ID.");
        return false;
      }
      bankAddressField.value = `UPI ID: ${upi}`;
    } else {
      const accountNumber = document.getElementById('account_number').value.trim();
      const ifsc = document.getElementById('ifsc').value.trim();
      const bankName = document.getElementById('bank_name').value.trim();
      const branchName = document.getElementById('branch_name').value.trim();

      if (!accountNumber || !ifsc || !bankName || !branchName) {
        alert("Please fill in all bank details.");
        return false;
      }

      bankAddressField.value =
        `Account Number: ${accountNumber}\n` +
        `IFSC Code: ${ifsc}\n` +
        `Bank Name: ${bankName}\n` +
        `Branch Name: ${branchName}`;
    }

    // Optionally show loader
    document.getElementById('loader-overlay').style.display = 'block';
    return true;
  }
</script>

{% include 'backend/influencer_footer.html' %}
